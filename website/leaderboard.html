<!DOCTYPE html>
<html>

<head>
	<title>Calorific Conversion</title>

	<!-- Compiled and minified CSS -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

	<!-- Compiled and minified JavaScript -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

	<!--Let browser know website is optimized for mobile-->
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>

<body>
	<div class="navbar-fixed">
		<nav>
			<div class="nav-wrapper green">
				<a href="./calorific-conversion.html" class="brand-logo center">Leaderboard</a>
				<a href="#" data-target="mobile" class="sidenav-trigger"><i class="material-icons">menu</i></a>
				<ul id="nav-mobile" class="right hide-on-med-and-down">
					<li><a href="./calorific-conversion.html">Home</a></li>
					<li class="active"><a href="./leaderboard.html">Leaderboard</a></li>
					<li><a href="./user.html">Activities</a></li>
				</ul>
			</div>
		</nav>
	</div>

	<ul class="sidenav" id="mobile">
		<li><a href="./calorific-conversion.html">Home</a></li>
		<li class="active"><a href="./leaderboard.html">Leaderboard</a></li>
		<li><a href="./user.html">Activities</a></li>
	</ul>

	<div class="container">
		<div class="row" style="margin-top: 5vh;">
			<div class="col s12">
				<table class="highlight" id="data-table">
					<thead>
						<tr>
							<th></th>
							<th>Distance (km)</th>
							<th>Ascent (m)</th>
							<th>Calories (kcal)</th>
						</tr>
						<tr class="grey lighten-3">
							<th>Total</th>
							<th id="totalDistance"></th>
							<th id="totalAscent"></th>
							<th id="totalCalories"></th>
						</tr>
					</thead>
				</table>
			</div>
		</div>
		<div class="row" style="margin-top: 5vh;">
			<div class="col s12 center-align">
				<p class="flow-text">
					Get yourself on the leaderboard by adding an activity! Players are ranked by the number of calories
					burned. How far can you (virtually) hike?
				</p>
			</div>
		</div>
		<div class="row" style="margin-top: 2vh;">
			<div class="col s12 m6 l4 offset-m3 offset-l4">
				<a href="user.html" style="width: -webkit-fill-available;"
					class="waves-effect waves-light btn green">Add An
					Activity</a>
			</div>
		</div>
	</div>

	<div id="modal1" class="modal">
		<div style="padding: 0;" class="modal-content">
			<h4 class="green white-text center-align" style="padding-top:1vh; padding-bottom:1vh; line-height: 1.2em;">
				<span id="modalName"></span>
			</h4>
			<div class="container">
				<table class="striped" id="modal-data-table">
					<thead>
						<tr>
							<th>Activity</th>
							<th>Calories</th>
						</tr>
					</thead>
					<tbody id="modal-table-body">

					</tbody>
				</table>
			</div>
		</div>
		<div class="modal-footer">
			<a href="#!" class="modal-close waves-effect waves-green btn-flat">Close</a>
		</div>
	</div>

	<script>
		document.addEventListener('DOMContentLoaded', function () {
			var elems = document.querySelectorAll('.sidenav');
			var instances = M.Sidenav.init(elems);

			var elems = document.querySelectorAll('.modal');
			var instances = M.Modal.init(elems);
		});

		window.fetch('https://onemonthonemountain.co.uk/scores.json').then((response) => response.json().then(({scores, totals}) => {
			const table = document.getElementById("data-table");

			document.getElementById("totalDistance").innerHTML = totals.distance.toFixed(1)
			document.getElementById("totalAscent").innerHTML = totals.ascent
			document.getElementById("totalCalories").innerHTML = totals.calories

			scores.forEach((person, index) => {
				var row = table.insertRow(index + 2)

				row.id = `userRow${index}`
				row.style.cursor = 'pointer'

				row.addEventListener("click", () => onUserClick(person))

				row.addEventListener("mouseover", (event) => {
					document.getElementById(`userRow${index}`).classList.add("z-depth-1")
				})

				row.addEventListener("mouseout", (event) => {
					document.getElementById(`userRow${index}`).classList.remove("z-depth-1")
				})

				var cell1 = row.insertCell(0);
				var cell2 = row.insertCell(1);
				var cell3 = row.insertCell(2);
				var cell4 = row.insertCell(3);

				cell1.innerHTML = person.name
				cell2.innerHTML = person.distance
				cell3.innerHTML = person.ascent
				cell4.innerHTML = person.calories
			})
		}))

		function onUserClick(user) {
			console.log(user)

			document.getElementById('modalName').innerHTML = user.name

			const tableBody = document.getElementById('modal-table-body')

			tableBody.innerHTML = ""

			user.activities.forEach(({description, calories}, index) => {
				var row = document.createElement('TR')

				var cell1 = row.insertCell(0);
				var cell2 = row.insertCell(1);

				cell1.innerHTML = description
				cell2.innerHTML = calories

				tableBody.appendChild(row)
			})

			const modalHtml = document.getElementById('modal1')

			const modal = M.Modal.getInstance(modalHtml)

			modal.open()
		}
	</script>
</body>

</html>
